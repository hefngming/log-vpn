# Log VPN 项目 TODO

## 数据库和基础架构
- [x] 配置用户订阅表
- [x] 配置订单表
- [x] 配置节点表
- [x] 配置支付配置表
- [x] 配置系统设置表
- [x] 配置验证码表

## Web 前端
- [x] 深色科技感主题配置
- [x] 首页设计（产品介绍+下载按钮）
- [x] 用户注册/登录页面
- [x] 用户控制台（订阅状态+流量统计）
- [x] 充值页面（收款码占位+易支付预留）
- [x] 客户端下载页面
- [x] 节点列表展示
- [x] 支付弹窗（微信/支付宝收款码）

## 后台管理系统
- [x] 用户列表管理
- [x] 手动激活/延长订阅按钮
- [x] 订单管理
- [x] 节点管理
- [x] 系统设置
- [x] 用户搜索功能

## API 服务
- [x] X-ui API 集成
- [x] 用户认证接口
- [x] 订阅状态验证
- [x] 流量上报接口
- [x] 节点列表接口
- [x] 验证码发送 API
- [x] 密码重置 API
- [x] 密码修改 API

## Electron 桌面客户端
- [x] 大连接按钮
- [x] 国家节点选择
- [x] 实时流量显示
- [x] 连接时长计时器
- [x] 左侧菜单导航
- [x] 与后端 API 联动

## 邮件通知
- [x] SMTP 配置（Gmail）
- [x] 注册验证码发送
- [x] 订阅到期提醒

## 新增功能 - 用户认证增强
- [x] 找回密码功能（邮箱验证码）
- [x] 更改密码功能（邮箱验证码确认）
- [x] 验证码表（5-10分钟有效期）
- [x] 防止恶意重复获取验证码（60秒限制）

## 新增功能 - 支付模块
- [x] 集成微信/支付宝收款码图片
- [x] 支付弹窗设计
- [x] 手机端保存/截图提示
- [x] 抽象支付类（预留易支付接口）
- [x] 支付配置文件说明

## 新增功能 - 后台管理
- [x] 用户搜索功能
- [x] 激活/续费按钮优化
- [x] API 集成实时数据


## 新增功能 - 支付审核闭环
- [x] 支付凭证表 (paymentProofs)
- [x] 凭证上传组件（图片上传）
- [x] 凭证上传 API
- [x] Telegram Bot 通知服务
- [x] 后台审核中心页面
- [x] 截图预览功能
- [x] 一键激活按钮
- [x] 激活确认邮件发送
- [x] 客服 TG 信息展示

## 新增功能 - 前后端握手与节点同步
- [x] 3x-ui API 集成增强（HTTPS 自签名证书支持）
- [x] 后端节点同步 tRPC 端点 (nodes.sync)
- [x] 多协议节点解析（VLESS、Trojan、Shadowsocks、VMess）
- [x] Sing-box 配置生成
- [x] 订阅链接生成（Base64 编码）
- [x] 前端节点列表页面重构
- [x] 节点同步按钮（管理员可见）
- [x] 节点详情显示（地址、端口、协议、加密方式）
- [x] 节点配置下载功能
- [x] 订阅链接复制功能
- [x] 节点搜索和过滤功能
- [x] 单元测试（12 个测试全部通过）
  - [x] syncNodesFromXui 响应结构验证
  - [x] 错误处理验证
  - [x] 节点字段验证
  - [x] Sing-box 配置生成
  - [x] 订阅链接生成
  - [x] 多协议支持（VLESS、Trojan、Shadowsocks、VMess）

## 新增功能 - 套餐配置更新
- [x] 更新数据库套餐配置（只保留免费版和无限尊享版）
- [x] 更新前端套餐展示页面
- [x] 更新后端 API 返回数据
- [x] 测试套餐购买流程

## 新增功能 - 设备指纹识别（防止免费版重复使用）
- [x] 创建设备指纹表（deviceFingerprints）
- [x] 实现设备指纹生成算法（浏览器 + 硬件特征）
- [x] 实现设备指纹验证 API
- [x] 集成指纹检查到免费版激活流程
- [x] 编写单元测试
- [x] 编写集成测试


## 新增功能 - 订阅模式和限制更新
- [x] 更新无限尊享版为 ¥199 永久订阅（endDate 设为 9999 年）
- [x] 实现每月流量限制（200GB/月）和自动重置
- [x] 实现每天流量限制（10GB/天）和自动重置
- [x] 实现流量达到限制时自动停止连接
- [x] 实现一账号一设备在线限制（新设备登录时踢掉旧设备）
- [x] 修复下载客户端按钮的跳转链接
- [x] 测试流量限制功能
- [x] 测试一账号一设备限制


## 修复 - 下载客户端 404 错误
- [x] 检查下载链接配置
- [x] 修复跳转逻辑
- [x] 测试下载功能


## 新增功能 - 服务器安装包集成
- [x] 测试服务器连接和安装包下载
- [x] 配置前端下载链接到服务器
- [x] 测试前端下载功能


## 新增功能 - 节点加密中转 API
- [x] 实现节点加密和解密模块（AES-256）
- [x] 创建后端中转 API 端点（nodes.getEncrypted）
- [x] 修改前端节点页面仅显示节点名称
- [x] 编写单元测试
- [x] 编写集成测试


## 新增功能 - Electron 客户端打包
- [x] 在服务器上寻找 Electron 客户端文件（Electron.exe/LogVPN.exe）
- [x] 解压 LogVPN_Setup 文件
- [x] 安装 NSIS 并配置打包脚本
- [x] 打包成 LogVPN_Installer.exe
- [x] 测试安装程序


## 新增功能 - 客户端自动更新和 3x-ui 配置
- [x] 在服务器上寻找 3x-ui 面板并配置端口
- [x] 创建后端版本管理 API 端点
- [x] 实现 Electron 客户端自动更新检查（每周一次）
- [x] 实现后台下载和强制更新功能
- [x] 配置 dj.siumingho.dpdns.org 域名访问
- [x] 测试自动更新功能


## 新增功能 - 新手引导流程
- [x] 创建新手引导数据管理模块
- [x] 实现气泡提示组件
- [x] 集成登录页面引导提示
- [x] 集成节点选择页面引导提示
- [x] 集成连接页面引导提示
- [x] 集成流量统计页面引导提示
- [x] 集成设置页面引导提示
- [x] 编写单元测试
- [x] 测试新手引导流程


## 修改 - 套餐 UI 更新
- [x] 更新前端套餐页面显示（免费体验 1天/1GB、无限尊享版 10GB/天 200GB/月 永久）
- [x] 测试套餐页面


## 新增功能 - Electron 客户端实时流量监控
- [x] 创建后端流量查询 API 端点
- [x] 实现 Electron 客户端流量监控模块
- [x] 实现流量警告弹窗功能（日流量/月流量接近限制时）
- [x] 实现流量数字显示（当前已用/总限制）
- [x] 编写单元测试
- [x] 测试流量监控功能


## 新增功能 - 域名配置和 SSL 证书
- [x] 检查 dj.siumingho.dpdns.org SSL 证书状态
- [x] 配置 Nginx 反代指向前端
- [x] 测试域名访问


## 修复 - Nodes.tsx useAuth 导入错误和 SSL 证书自动续绿
- [x] 修复 Nodes.tsx 中的 useAuth 导入路径
- [x] 设置 SSL 证书自动续绿（Certbot 自动更新）
- [x] 测试修复效果


## 新增功能 - Electron 客户端集成（自动更新、流量监控、新手引导）
- [x] 检查 Electron 客户端项目结构
- [x] 集成自动更新模块到 Electron 主进程
- [x] 集成流量监控模块到 Electron 主进程
- [x] 集成新手引导模块到 Electron 渲染进程
- [x] 编写集成测试验证所有模块（36 个测试用例全部通过）
- [x] 测试完整的客户端功能流程


## 新增功能 - Electron Builder 自动化构建和发布
- [ ] 安装 Electron Builder 依赖
- [ ] 创建 Electron Builder 配置文件
- [ ] 配置 Windows NSIS 打包配置
- [ ] 配置 macOS DMG 打包配置
- [ ] 创建打包和发布脚本
- [ ] 实现自动更新检查集成
- [ ] 测试 Windows 打包流程
- [ ] 测试 macOS 打包流程
- [ ] 配置 GitHub Actions CI/CD 流程


## 修复 - 前端下载界面优化
- [x] 移除第三方客户端部分
- [x] 修复下载链接指向服务器安装包
- [x] 添加详细的安装指南
- [x] 添加常见问题解答
- [x] 测试安装包下载功能
- [x] 测试后端 API 连接功能


## 新增功能 - 下载功能增强（进度追踪、版本检查、安装包校验）
- [ ] 计算安装包 MD5/SHA256 校验值
- [ ] 添加版本管理表到数据库
- [ ] 创建版本检查 API 端点
- [ ] 实现下载进度追踪组件
- [ ] 实现客户端版本检查功能
- [ ] 实现安装包校验功能
- [ ] 修复前端下载页面集成所有功能
- [ ] 编写集成测试


## 完成 - 下载功能增强（进度追踪、版本检查、安装包校验）
- [x] 计算安装包 MD5/SHA256 校验值
- [x] 添加版本管理文件到项目
- [x] 实现下载进度追踪组件（DownloadProgressTracker）
- [x] 实现客户端版本检查功能（VersionChecker）
- [x] 实现安装包校验功能（FileHashVerifier）
- [x] 修复前端下载页面集成所有功能
- [x] 编写集成测试（50+ 测试用例）


## 修复 - 前端下载页面显示第三方客户端问题
- [x] 检查前端下载页面代码
- [x] 重新构建前端（pnpm build）
- [x] 重启前端服务器
- [x] 验证修复结果（只显示官方 Log VPN 安装包）


## 完成 - 使用 Sing-box 封装 LogVPN 客户端
- [x] 下载 Sing-box 核心二进制文件 (v1.12.17)
- [x] 创建 Sing-box 配置文件（包含香港-快速专线节点）
- [x] 为 Windows 创建 LogVPN 客户端包装脚本 (NSIS)
- [x] 为 macOS 创建 LogVPN 客户端包装 (App Bundle)
- [x] 打包并上传到服务器
- [x] 更新前端下载页面指向新的客户端
- [x] 修复 Nginx 配置以支持静态文件下载
- [x] 验证下载链接正常工作 (HTTP 200)


## 新增功能 - 设备管理和登录通知
- [ ] 添加设备管理界面 - 显示当前绑定的设备信息
- [ ] 实现设备详情查看（绑定时间、最后活跃时间）
- [ ] 实现手动解绑设备功能
- [ ] 后端添加设备白名单表
- [ ] 实现管理员设置用户多设备权限
- [ ] 客户端支持多设备登录（白名单用户）
- [ ] 实现新设备登录邮件通知
- [ ] 邮件包含设备信息和登录时间
- [ ] 添加可疑登录警告

## 新增功能 - 客户端打包和发布
- [ ] 配置 Windows 打包脚本（electron-builder）
- [ ] 配置 macOS 打包脚本（electron-builder）
- [ ] 生成可执行安装程序
- [ ] 测试安装程序
- [ ] 上传到服务器供用户下载


## 新增任务 - 客户端打包和管理功能
- [x] 创建客户端完整压缩包
- [x] 实现登录通知功能（新设备登录邮件通知）
- [x] 添加管理员后台设备白名单管理界面
- [ ] 测试所有功能


## 套餐和下载页面更新
- [x] 修改套餐页面只保留免费版（1天/1GB）和无限尊享版（10GB/天，200GB/月）
- [x] 更新下载页面的客户端安装程序链接


## 分享推荐功能
- [x] 创建推荐码和邀请记录数据库表
- [x] 实现后端推荐系统数据库函数（生成推荐码、记录邀请、发放奖励）
- [ ] 实现后端推荐系统 API 路由
- [ ] 实现客户端分享界面（生成邀请链接、查看推荐记录）
- [ ] 集成到注册流程（新用户通过邀请链接注册）
- [ ] 测试推荐流程和流量奖励


## 完成推荐系统和测试
- [x] 修改流量奖励为推荐人 1GB，被推荐人 1GB
- [x] 添加推荐系统 tRPC API 路由
- [x] 创建前端分享界面（显示邀请链接、推荐统计）
- [ ] 集成到注册流程（新用户通过邀请链接注册）
- [ ] 测试核心用户流程（注册、购买、下载、登录、连接）
- [ ] 上传客户端安装程序到服务器


## 推荐系统最终集成
- [ ] 集成推荐码到注册流程（添加推荐码输入框，URL 参数自动填入）
- [ ] 在导航栏添加"邀请好友"链接
- [ ] 测试完整推荐流程（创建测试账号、生成邀请链接、验证流量奖励）


## 新增功能 - 注册邮箱验证码和付费通知
- [x] 在注册页面添加邮箱验证码功能
- [x] 实现发送验证码 API（60秒限制）
- [x] 实现验证码验证逻辑
- [x] 配置 SMTP 邮件服务（Gmail: siuminghe@gmail.com）
- [x] 实现付费成功 Telegram 通知功能
- [ ] 测试邮箱验证码发送和验证
- [ ] 测试 Telegram 通知功能


## 测试和优化 - 验证码和通知功能
- [x] 测试注册页面验证码发送功能
- [x] 测试验证码邮件接收
- [ ] 测试验证码验证逻辑
- [ ] 测试支付凭证上传 Telegram 通知（需要修复 Chat ID）
- [x] 添加验证码重发提示（未收到验证码？）


## 用户体验优化 - 验证码错误提示
- [x] 添加验证码输入错误提示（红色文字）
- [x] 测试完整注册流程（发送验证码 → 输入验证码 → 注册成功）
- [ ] 验证 Telegram 通知配置（需要用户先向 Bot 发送消息获取 Chat ID）


## 支付流程测试
- [x] 创建测试文档（PAYMENT_FLOW_TEST.md）
- [x] 优化 Telegram 通知（移除重复通知）
- [ ] 配置 Telegram Bot Chat ID（需要用户先向 Bot 发送消息）
- [ ] 创建测试账号（使用邮箱验证码注册）
- [ ] 测试购买套餐流程
- [ ] 测试上传支付凭证
- [ ] 验证 Telegram 通知是否发送
- [ ] 验证通知内容是否正确（用户邮箱、套餐、金额、订单号）


## UI 优化 - 套餐展示和付款页面
- [x] 移除前端三个套餐展示（基础版 ￥29、专业版 ￥59、企业版 ￥199）
- [x] 修改为单一无限尊享套餐展示
- [x] 在无限尊享套餐中添加付款页面（二维码展示）
- [x] 添加上传支付截图功能
- [x] 付款完成后发送信息到 Telegram
- [x] 执行完整支付流程测试（Telegram Bot 配置成功）


## 管理后台优化 - 批量审核功能
- [x] 添加后端批量审核 API（批量通过、批量拒绝）
- [x] 前端添加全选/取消全选复选框
- [x] 前端添加批量通过按钮
- [x] 前端添加批量拒绝按钮
- [x] 批量操作后自动刷新列表
- [x] 测试批量审核功能（需要管理员账号登录后才能访问）


## UI 优化 - 免费体验套餐和支付凭证导出
- [x] 在首页添加免费体验套餐入口（1天，1GB）
- [x] 在充值页面添加免费体验套餐选项
- [x] 实现每设备只能体验一次的限制（后端已实现）
- [x] 修复订阅付费无弹出二维码问题
- [x] 添加支付凭证导出为 Excel 功能
- [x] 添加支付凭证导出为 CSV 功能
- [x] 测试免费体验套餐功能（前端 UI 已完成）
- [x] 测试支付凭证导出功能（导出按钮已添加）
