{
  "query": "-- 添加新字段到 nodes 表\nALTER TABLE nodes \nADD COLUMN IF NOT EXISTS xuiId INT NOT NULL DEFAULT 0 AFTER id,\nADD COLUMN IF NOT EXISTS displayName VARCHAR(100) NOT NULL DEFAULT '' AFTER name,\nADD COLUMN IF NOT EXISTS encryptedConfig TEXT AFTER port,\nADD COLUMN IF NOT EXISTS streamSettings TEXT AFTER settings,\nADD COLUMN IF NOT EXISTS lastSyncAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP AFTER sortOrder;\n\n-- 修改 protocol 字段类型\nALTER TABLE nodes MODIFY COLUMN protocol VARCHAR(50) NOT NULL;\n\n-- 修改 country 和 countryCode 为可选\nALTER TABLE nodes MODIFY COLUMN country VARCHAR(50) NULL;\nALTER TABLE nodes MODIFY COLUMN countryCode VARCHAR(10) NULL;\n\n-- 添加 xuiId 唯一索引（如果不存在）\nALTER TABLE nodes ADD UNIQUE INDEX IF NOT EXISTS idx_xuiId (xuiId);",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 2niMBJFQbqWKXSJ.root --database ik4QKwpUJXHkdpgpXC9yL3 --execute -- 添加新字段到 nodes 表\nALTER TABLE nodes \nADD COLUMN IF NOT EXISTS xuiId INT NOT NULL DEFAULT 0 AFTER id,\nADD COLUMN IF NOT EXISTS displayName VARCHAR(100) NOT NULL DEFAULT '' AFTER name,\nADD COLUMN IF NOT EXISTS encryptedConfig TEXT AFTER port,\nADD COLUMN IF NOT EXISTS streamSettings TEXT AFTER settings,\nADD COLUMN IF NOT EXISTS lastSyncAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP AFTER sortOrder;\n\n-- 修改 protocol 字段类型\nALTER TABLE nodes MODIFY COLUMN protocol VARCHAR(50) NOT NULL;\n\n-- 修改 country 和 countryCode 为可选\nALTER TABLE nodes MODIFY COLUMN country VARCHAR(50) NULL;\nALTER TABLE nodes MODIFY COLUMN countryCode VARCHAR(10) NULL;\n\n-- 添加 xuiId 唯一索引（如果不存在）\nALTER TABLE nodes ADD UNIQUE INDEX IF NOT EXISTS idx_xuiId (xuiId);",
  "returncode": 1,
  "logs": [
    "ERROR 1064 (42000) at line 17: You have an error in your SQL syntax; check the manual that corresponds to your TiDB version for the right syntax to use line 1 column 37 near \"IF NOT EXISTS idx_xuiId (xuiId)\""
  ]
}